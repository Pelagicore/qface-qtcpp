{% import "qface/qtcpp.j2" as cpp %}
{{ cpp.autogenerated(prefix="#") }}
{% set module_name = module.name|identifier %}
{% set module_path = module.name_parts|path %}

find_package(Qt5Core REQUIRED)
find_package(Qt5Qml REQUIRED)

set (SOURCES
    generated/{{module.module_name|lower}}module.cpp
{% for interface in module.interfaces %}
    generated/abstract{{interface|lower}}.cpp
{% endfor %}
{% for struct in module.structs %}
    generated/{{struct|lower}}.cpp
    generated/{{struct|lower}}model.cpp
{% endfor %}
    generated/variantmodel.cpp
{% for interface in module.interfaces %}
    {{interface|lower}}.cpp
{% endfor %}
    plugin.cpp
)

add_library({{module_name}} SHARED ${SOURCES})

set(OUTPUT_PATH ${INSTALL_PATH}/{{module_path}})

set_target_properties({{module_name}} PROPERTIES
    LIBRARY_OUTPUT_DIRECTORY ${OUTPUT_PATH}
    RUNTIME_OUTPUT_DIRECTORY ${OUTPUT_PATH}
)

target_link_libraries({{module_name}} PUBLIC Qt5::Core Qt5::Qml)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/qmldir ${OUTPUT_PATH}/qmldir COPYONLY)
